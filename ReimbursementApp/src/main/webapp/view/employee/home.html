<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Reimbursement Home</title>
    <!-- Vendor -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <!-- Custom Styles -->
    <link rel="stylesheet" href="./view/styles.css">
</head>
<body>
    
<div class="header">
    <div class="container">
    <h1>Expense Reimbursement System</h1>
        </div>
    
</div>
<div class="navigation">  
    <div class="container">
    <ul>
    <li><a class="nav-item nav-link active" href="./home">Home</a></li>
    <li><a class="nav-item nav-link" href="./requests">Requests</a></li>
    <li><a class="nav-item nav-link" href="./profile">Profile</a></li>
    <li><a class="nav-item nav-link" href="./logout">Logout</a></li>
    </ul>
    </div>
</div>

    
    <div class="container">
       <h2>Employee Request Portal</h2>

            <a class="btn btn-primary btn-request" href="./requests/new">Make a new request </a>

            <h3>My Pending Requests</h3>
            <table class="table">
                <thead>
                <tr>
                    <th>Request Num.</th>
                    <th>Subject</th>
                    <th>Amount Requested</th>
                </tr>
                </thead>
                <tbody id="pending-requests">

                </tbody>
            </table>
    </div>
</body>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
<script>
    window.onload = function(){

        
        let pendingRequestsUrl = './api/requests';
        
        getRequest(pendingRequestsUrl + '?status=1', getPendingRequests);
        console.log('hi');

        function getRequest(url, func){
            let xhr = new XMLHttpRequest();
            
            xhr.onreadystatechange = function(){
                if(this.readyState == 4 && this.status == 200){
                    func(this);
                }
            }
            xhr.open('GET', url);
            xhr.send();
        }


        function getPendingRequests(xhr) {
            let pendingRequests = document.getElementById('pending-requests');
            let results = JSON.parse(xhr.response);

            console.log(results);
            for(result of results.requests) {
                let tableRow = document.createElement('tr');
                let requestNumCell = document.createElement('td');
                let subjectCell = document.createElement('td');
                let amountCell = document.createElement('td');

                requestNumCell.innerHTML = result.requestId;
                subjectCell.innerHTML = result.subject;
                amountCell.innerHTML = result.requestedAmount;

                tableRow.appendChild(requestNumCell);
                tableRow.appendChild(subjectCell);
                tableRow.appendChild(amountCell);

                pendingRequests.appendChild(tableRow);

            }
        }
    };
</script>
</html> 