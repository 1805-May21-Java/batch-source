<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Reimbursement Home</title>
    <!-- Vendor -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <!-- Custom Styles -->
</head>
<body>
    <div class="container">
        <h1>Reimbursement Portal</h1>
        <ul>
            <li><a href="./home">Home</a></li>
            <li><a href="./requests">Requests</a></li>
            <li><a href="./profile">Profile</a></li>
            <li><a href="./logout">Logout</a></li>
        </ul>

    <a href="./requests/new">Make a new request</a>

        <div>

        <h2>Pending Requests</h2>
        <table class="table">
            <thead>
            <tr>
                <th>Request Num.</th>
                <th>Subject</thtques>
                <th>Amount Requested</th>
            </tr>
            </thead>
            <tbody id="pending-requests">

            </tbody>
        </table>
        <a href="./requests">View all requests</a>
        </div>
    </div>
</body>
<script>
    window.onload = function(){

        
        let pendingRequestsUrl = './api/requests';
        
        getRequest(pendingRequestsUrl + '?status=1', getPendingRequests);
        console.log('hi');

        function getRequest(url, func){
            let xhr = new XMLHttpRequest();
            
            xhr.onreadystatechange = function(){
                if(this.readyState == 4 && this.status == 200){
                    func(this);
                }
            }
            xhr.open('GET', url);
            xhr.send();
        }


        function getPendingRequests(xhr) {
            let pendingRequests = document.getElementById('pending-requests');
            let results = JSON.parse(xhr.response);

            console.log(results);
            for(result of results.requests) {
                let tableRow = document.createElement('tr');
                let requestNumCell = document.createElement('td');
                let subjectCell = document.createElement('td');
                let amountCell = document.createElement('td');

                requestNumCell.innerHTML = result.requestId;
                subjectCell.innerHTML = result.subject;
                amountCell.innerHTML = result.requestedAmount;

                tableRow.appendChild(requestNumCell);
                tableRow.appendChild(subjectCell);
                tableRow.appendChild(amountCell);

                pendingRequests.appendChild(tableRow);

            }
        }
    };
</script>
</html> 